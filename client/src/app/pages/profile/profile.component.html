<div class="min-h-screen w-full flex flex-col justify-center items-center bg-base-200">
  <div class="w-full flex justify-end items-center px-4 pt-6">
    <button class="btn btn-primary btn-outline" (click)="showGroupsModal = true">Ver mis grupos y unirme</button>
  </div>
  <div class="w-full flex flex-col md:flex-row items-start gap-10 bg-linear-to-br from-primary/10 to-base-100/80 rounded-2xl shadow-lg border border-base-300 p-8 md:p-16 mt-0 md:mt-16 transition-all duration-200">
    <!-- Foto y formulario en fila en desktop, columna en móvil -->
    <div class="w-full flex flex-col md:flex-row md:items-start md:gap-10">
      <!-- Lado izquierdo: foto, logo, frase -->
      <div class="flex flex-col items-center md:items-start md:mr-10 mb-6 md:mb-0 w-full max-w-xs mx-auto gap-4">
        <div class="rounded-full bg-base-300 border border-base-200 w-36 h-36 flex items-center justify-center overflow-hidden shadow-md mx-auto mt-2 mb-2">
          <svg class="w-24 h-24 text-base-content/20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <label class="btn btn-xs text-xs font-normal rounded-full bg-primary text-white border-none hover:bg-primary/80 transition-all duration-150 mx-auto mt-1 mb-2" style="min-width:100px;">
          <input type="file" hidden />
          Cambiar foto
        </label>
        <div class="flex-1"></div>
        <div class="flex flex-col items-center w-full gap-2 mt-20 mb-2 p-4 rounded-xl bg-base-100/80 shadow-sm">
          <img src="/img/cbiLogo.svg" alt="Logo" class="w-16 h-16 mb-4" />
          <span class="text-xs text-base-content/60 text-center leading-relaxed block px-2 mt-4">"Pues Dios amó tanto al mundo que dio a su único Hijo, para que todo el que crea en él no se pierda, sino que tenga vida eterna. Dios no envió a su Hijo al mundo para condenar al mundo, sino para salvarlo por medio de él."<br><b>Juan 3:16-17 (NTV)</b></span>
        </div>
      </div>
      <!-- Lado derecho: formulario -->
      <div class="flex-1 w-full">
      
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full">
        <div *ngIf="errorMessage()" class="alert alert-error mb-4 md:col-span-2 text-xs">{{ errorMessage() }}</div>
        <div *ngIf="successMessage()" class="alert alert-success mb-4 md:col-span-2 text-xs">{{ successMessage() }}</div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="name">Nombre</label>
          <input id="name" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Nombre" formControlName="name" type="text" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="email">Email</label>
          <input id="email" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Email" formControlName="email" type="email" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="number">Teléfono</label>
          <input id="number" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Teléfono" formControlName="number" type="text" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="address">Dirección</label>
          <input id="address" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Dirección" formControlName="address" type="text" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="happybirth">Fecha de nacimiento</label>
          <input id="happybirth" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Fecha de nacimiento" formControlName="happybirth" type="date" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="gender">Género</label>
          <select id="gender" class="select select-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" formControlName="gender">
            <option value="">Género</option>
            <option *ngFor="let g of genderOptions" [value]="g">{{ g }}</option>
          </select>
        </div>
        <!-- <div class="flex items-center gap-2">
          <input class="checkbox" formControlName="baptized" type="checkbox" id="baptized" />
          <label for="baptized" class="text-xs">Bautizado</label>
        </div> 
         <div class="flex items-center gap-2">
          <input class="checkbox" formControlName="isActive" type="checkbox" id="isActive" />
          <label for="isActive" class="text-xs">Activo</label>
        </div> -->
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="age">Edad</label>
          <input id="age" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Edad" formControlName="age" type="number" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="hobbies">Hobbies</label>
          <input id="hobbies" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Hobbies" formControlName="hobbies" type="text" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="dreams">Sueños</label>
          <input id="dreams" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Sueños" formControlName="dreams" type="text" />
        </div>
        <div class="form-control w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="job">Trabajo</label>
          <input id="job" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Trabajo" formControlName="job" type="text" />
        </div>
        <div class="form-control md:col-span-2 w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="levelDicipules">Nivel de Discipulado</label>
          <select id="levelDicipules" class="select select-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" formControlName="levelDicipules">
            <option [value]="'I'">I</option>
            <option [value]="'II'">II</option>
            <option [value]="'III'">III</option>
            <option [value]="'IV'">IV</option>
          </select>
        </div>
        <div class="form-control md:col-span-2 w-full">
          <label class="label text-xs font-semibold text-base-content/70 mb-1" for="vulnerable_area">Área vulnerable</label>
          <input id="vulnerable_area" class="input input-bordered w-full bg-base-100 focus:outline-none focus:ring-2 focus:ring-primary/30 rounded-lg" placeholder="Área vulnerable" formControlName="vulnerable_area" type="text" />
        </div>
        <button class="btn btn-primary w-full md:col-span-2 mt-4 py-2 rounded-lg shadow-md text-base font-medium tracking-wide transition-all duration-150" type="submit" [disabled]="isLoading()">Guardar cambios</button>
      </form>
      
    </div>
  </div>

  <!-- Modal de grupos y gestión -->
  <div *ngIf="showGroupsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
    <div class="bg-white dark:bg-base-200 rounded-2xl shadow-2xl border border-primary/30 p-8 w-full max-w-2xl relative animate-fade-in">
      <button class="absolute top-2 right-2 btn btn-xs btn-circle btn-ghost" (click)="showGroupsModal = false">✕</button>
      <h2 class="text-xl font-bold text-primary mb-4 flex items-center gap-2">
        <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87m9-5.13a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
        Mis Grupos
      </h2>
      <div *ngIf="groupLoading() && groupList().length === 0" class="flex items-center gap-2 text-primary/70 mb-4">
        <span class="loading loading-spinner loading-md"></span> Cargando grupos...
      </div>
      <div *ngIf="!groupLoading() && groupList().length === 0" class="text-base-content/60 italic mb-4">No perteneces a ningún grupo actualmente.</div>
      <div *ngIf="!groupLoading() && groupList().length > 0" class="flex flex-col gap-4 mb-8">
        <div *ngFor="let group of groupList()" class="flex flex-col md:flex-row items-center justify-between gap-4 p-4 rounded-xl border border-base-300 bg-base-100/80 shadow-sm transition-all duration-200 hover:shadow-md">
          <div class="flex flex-col md:flex-row md:items-center gap-2 md:gap-6 flex-1">
            <span class="font-semibold text-base-content text-lg">{{ group.groupName }}</span>
            <span class="text-xs text-base-content/60">Nivel de Discipulado: <b>{{ profileForm.get('levelDicipules')?.value }}</b></span>
          </div>
          <button class="btn btn-error btn-sm rounded-md px-4 shadow hover:scale-105 transition-transform duration-150" (click)="leaveGroup(profileForm.get('id')?.value, group.groupId)">
            Salir del grupo
          </button>
        </div>
      </div>
      <div class="divider my-8">Unirse a un grupo</div>
      <div *ngIf="allGroupsLoading()" class="flex items-center gap-2 text-primary/70 mb-4">
        <span class="loading loading-spinner loading-md"></span> Cargando todos los grupos...
      </div>
      <div *ngIf="!allGroupsLoading() && allGroups().length > 0" class="flex flex-col gap-3 max-h-96 overflow-y-auto">
        <div *ngFor="let group of allGroups()" class="flex items-center justify-between gap-4 p-3 rounded-lg border border-base-300 bg-base-100/80 shadow-sm">
          <span class="font-medium text-base-content flex items-center gap-2">
            <ng-container *ngIf="isMemberOfGroup(group.id); else notMember">
              <span class="inline-block w-2.5 h-2.5 rounded-full bg-primary"></span>
              {{ group.name }}
              <span class="ml-2 text-xs text-primary font-semibold">(Miembro)
                <ng-container *ngIf="getGroupLevel(group.id)">
                  - Nivel de Discipulado {{ getGroupLevel(group.id) }}
                </ng-container>
              </span>
            </ng-container>
            <ng-template #notMember>{{ group.name }}</ng-template>
          </span>
          <ng-container *ngIf="isMemberOfGroup(group.id); else joinBtn">
            <button class="btn btn-error btn-xs rounded-md px-4 shadow hover:scale-105 transition-transform duration-150"
              (click)="leaveGroup(profileForm.get('id')?.value, group.id)">
              Salir
            </button>
          </ng-container>
          <ng-template #joinBtn>
            <button class="btn btn-primary btn-xs rounded-md px-4 shadow hover:scale-105 transition-transform duration-150"
              (click)="joinGroup(group.id)">
              Unirse
            </button>
          </ng-template>
        </div>
      </div>
      <div *ngIf="!allGroupsLoading() && allGroups().length === 0" class="text-base-content/60 italic mb-4">No hay grupos disponibles.</div>
    </div>
  </div>
  </div>
</div>